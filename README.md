# DCSSpectrumTool
Python GUI for generating x-ray spectra specific to the Dynamic Compression Sector at the Advanced Photon Source. This is essentially just a front-end for srwlib but with DCS-specific parameters. 

## Installation Instructions for making a new python environment for this tool for windows. 

I'm using the oasys_srw library's version of srwlib, which is very specific about the python version so I keep it to its own environment.  If you want to adapt to your base environment, you can install srwlib or compile a compatible version and change the library dependencies of the code to refer to that instead of oasys_srw.srwlib.

1) install miniconda (latest version is fine), you shouldn't need to make it the active python 3 install or add it to path, but those are fine too.
https://repo.anaconda.com/miniconda/Miniconda3-latest-Windows-x86_64.exe

2) run Anaconda(Miniconda) powershell , which is a shortcut generated by the miniconda installer. Should be in your start-menu, but the shortcut is just the following: 
%windir%\System32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy ByPass -NoExit -Command "& '<YourMinicondaFolder>\shell\condabin\conda-hook.ps1' ; conda activate '<YourMinicondaFolder>' "
where <YourMinicondaFolder> should be replaced with your Miniconda3 install location. e.g. for me: <YourMinicondaFolder> = C:\Users\myusername\Miniconda3
This location is also common: C:\Users\myusername\AppData\Local\miniconda3


3) conda env create -n env_DCSSpectrum -f "<DCSSpectrumToolFolderLocation>\requirements_DCSSpectrum.yaml"
replace <DCSSpectrumToolFolderLocation> with the location where you put this folder
This makes a new python environment with the required libraries, so it shouldn't affect any existing python environments. 

5) You can run this by activating the environment we just created and then running the script: 
conda activate env_DCSSpectrum
python <DCSSpectrumToolFolderLocation>\DCSSpectrum.py

If you want to make a shortcut for this, so you don't need to use the terminal in the future, it needs to point to the python.exe for the environment we created. For example, the shortcut is now: 
<YourMinicondaFolder>\envs\env_DCSSpectrum\python.exe "<DCSSpectrumToolFolderLocation>\DCSSpectrum.py"
Replace the folder locations with yours.




## Linux Installation: 

TBD.


## Instructions for Use: 
Click 'Calc' to create a 1D spectral calculation eV vs Spectral Power (W/eV), plotted with matplotlib. 
Use the U14/U23 pulldown menu to select the undulator magnet set. You can specify the energy of a harmonic by specifying the harmonic # and the peak energy. Doing this will roughly set the peak to that energy. If you want a more precise peak location, specify the energy then click 'Optimize K', which will find a K parameter that has your specified peak energy and it will select the 'Use K' checkbox. When the 'Use K' Checkbox is checked, it will ignore the energy value you've specified and just use the K value specified in the edit box. 

Add x-ray mirrors and filters with the corresponding buttons, which open GUIs for specifying those. 

The Multilayer Monochromator widget uses a table of pre-calculated ML reflectivities vs energy and angle (the very large files in this folder) since those calculations tend to be slow. Enable the ML with the checkbox. Specify the multilayer you're using. Set the desired energy. Then Click Set Angle. The Incidence Angle field is what the calculation actually uses, so if you change energy you need to click Set Angle again. Plot vs Angle is just so you can visualize the width. 

Click Calc again to see the spectrum using the x-ray optical components you've added. 

File-> Save Spectrum to CSV to save a CSV of the calculated spectrum with the current parameters (not the latest plot, it will recalculate the spectrum). 

In the plotted 1D spectra, you can click-drag to highlight a region and see the Power within that energy region in the status bar. The total power for the entire spectrum is shown at the bottom of the main window for comparison. 
